<!doctype html><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" charset="utf-8"><title>OpexAI</title><base href="/"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/x-icon" href="favicon.ico"><link href="styles.75ae81752f83a63bc26a.bundle.css" rel="stylesheet"/></head><body><app-root></app-root><div class="control"><button id="startAndStop" disabled="disabled">Start</button></div><textarea style="display: none" class="code" rows="29" cols="80" id="codeEditor" spellcheck="false">
  </textarea><p style="display:none" class="err" id="errorMessage"></p><div><table style="display:none" cellpadding="0" cellspacing="0" width="0" border="0"><tr><td style="display:none"><video id="videoInput" width="320" height="240"></video></td><td style="display:none"><canvas id="canvasOutput" width="320" height="240"></canvas></td><td></td><td></td></tr><tr><td style="display:none"><div class="caption">videoInput</div></td><td><div class="caption">canvasOutput</div></td><td></td><td></td></tr></table></div><script src="https://webrtc.github.io/adapter/adapter-5.0.4.js" type="text/javascript"></script><script src="/assets/utils.js" type="text/javascript"></script><script id="codeSnippet" type="text/code-snippet">let video = document.getElementById('videoInput');
let src = new cv.Mat(video.height, video.width, cv.CV_8UC4);
let dst = new cv.Mat(video.height, video.width, cv.CV_8UC4);
let gray = new cv.Mat();
let cap = new cv.VideoCapture(video);
let faces = new cv.RectVector();
let classifier = new cv.CascadeClassifier();

// load pre-trained classifiers
classifier.load('haarcascade_frontalface_default.xml');

const FPS = 30;
function processVideo() {
    try {
        if (!streaming) {
            // clean and stop.
            src.delete();
            dst.delete();
            gray.delete();
            faces.delete();
            classifier.delete();
            return;
        }
        let begin = Date.now();
        // start processing.
        cap.read(src);
        src.copyTo(dst);
        cv.cvtColor(dst, gray, cv.COLOR_RGBA2GRAY, 0);
        // detect faces.
        classifier.detectMultiScale(gray, faces, 1.1, 3, 0);
        // draw faces.
        for (let i = 0; i < faces.size(); ++i) {
            let face = faces.get(i);
            let point1 = new cv.Point(face.x, face.y);
            let point2 = new cv.Point(face.x + face.width, face.y + face.height);
            cv.rectangle(dst, point1, point2, [255, 0, 0, 255]);
        }
        cv.imshow('canvasOutput', dst);
        // schedule the next one.
        let delay = 1000/FPS - (Date.now() - begin);
        setTimeout(processVideo, delay);
    } catch (err) {
        utils.printError(err);
    }
};

// schedule the first one.
setTimeout(processVideo, 0);</script><script type="text/javascript">let utils = new Utils('errorMessage');
  console.log('Inside');
  utils.loadCode('codeSnippet', 'codeEditor');

  let streaming = false;
  let videoInput = document.getElementById('videoInput');
  let startAndStop = document.getElementById('startAndStop');
  let canvasOutput = document.getElementById('canvasOutput');
  let canvasContext = canvasOutput.getContext('2d');

  startAndStop.addEventListener('click', () => {
      if (!streaming) {
          utils.clearError();
          utils.startCamera('qvga', onVideoStarted, 'videoInput');
      } else {
          utils.stopCamera();
          onVideoStopped();
      }
  });

  function onVideoStarted() {
      streaming = true;
      startAndStop.innerText = 'Stop';
      videoInput.width = videoInput.videoWidth;
      videoInput.height = videoInput.videoHeight;
      utils.executeCode('codeEditor');
  }

  function onVideoStopped() {
      streaming = false;
      canvasContext.clearRect(0, 0, canvasOutput.width, canvasOutput.height);
      startAndStop.innerText = 'Start';
  }

  utils.loadOpenCv(() => {
      let faceCascadeFile = 'haarcascade_frontalface_default.xml';
      utils.createFileFromUrl(faceCascadeFile, faceCascadeFile, () => {
          startAndStop.removeAttribute('disabled');
          utils.clearError();
          utils.startCamera('qvga', onVideoStarted, 'videoInput');
      });
  });</script><script type="text/javascript" src="inline.624c52e0ea0ec5727e8b.bundle.js"></script><script type="text/javascript" src="polyfills.7fda3a96bd9d1a2a0e75.bundle.js"></script><script type="text/javascript" src="scripts.b868cf54b9bf6076583c.bundle.js"></script><script type="text/javascript" src="main.b4f78205ed259eea2c5b.bundle.js"></script></body></html>